<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TKAN - A Cardano Trash Kan to clean up SCAM and unwanted tokens and protect the Cardano ecosystem.">
    <title>TKAN - The Cardano Trash Kan</title>
    <style>
        /* General Reset */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
        }

        /* Top Section with Particles Background */
        header {
            position: relative;
            height: 300px;
            background: linear-gradient(145deg, #1e1e2f, #2c2c4a);
            color: white;
            text-align: center;
            overflow: hidden;
        }

        #particles-js {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        header img {
            z-index: 1;
            position: relative;
            border-radius: 50%;
            max-width: 150px;
        }

        header h1, header p {
            z-index: 1;
            position: relative;
            margin: 10px;
        }

        /* Content Section */
        .container {
            padding: 20px;
        }

        .send-tokens-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #007bff;
            color: #fff;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
        }

        .send-tokens-btn:hover {
            background: #0056b3;
        }

        h2, h3 {
            color: #1f1f1f;
        }

        .btn {
            display: inline-block;
            background: #007bff;
            color: #fff;
            padding: 10px 20px;
            margin: 20px 0;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }

        .btn:hover {
            background: #0056b3;
        }

        .wallet-info {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .wallet-info p {
            margin: 10px 0;
        }

        .wallet-info code {
            background-color: #f4f4f4;
            padding: 5px;
            border-radius: 3px;
            display: inline-block;
        }

        .footer {
            background: #1f1f1f;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            margin-top: 20px;
        }

        .social {
            margin-top: 10px;
        }

        .social a {
            color: #1da1f2;
            text-decoration: none;
        }

        .social a:hover {
            text-decoration: underline;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cbor-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/base64-js"></script>
</head>
<body>

<header>
    <div id="particles-js"></div>
    <img src="assets/TKAN-logo2.png" alt="TKAN Logo">
    <h1>TKAN - The Cardano Trash Kan</h1>
    <p>Guardians of Purity in the Cardano Ecosystem</p>
</header>

<div class="container">
    <a href="#send-tokens" class="send-tokens-btn">Send Tokens</a>

    <div class="story">
        <h2>Our Mission</h2>
        <p>
            The Cardano ecosystem is filled with clutter from harmful SCAM or unwanted tokens, and trash NFTs. These pollutants
            poison your wallet and the environment. TKAN aims to solve this by creating a "Trash Kan" on the Cardano blockchain.
        </p>
        <p>
            With TKAN, you can send any SCAM or unwanted tokens or NFTs to our address, where they will be locked forever. Our smart contract
            ensures these tokens are disposed of responsibly, keeping them out of circulation and your sight.
        </p>
    </div>

    <div class="how-it-works">
        <h2>How It Works</h2>
        <p>
            When you send SCAM or unwanted tokens to TKAN's address, our validator locks them permanently in a specific trash can on
            the blockchain. The validator script ensures that these tokens cannot be moved ever again. This is how we protect
            the Cardano environment.
        </p>
        <p>
            In exchange for a small fee (the same amount the SCAMMER sent you, with a minimum of 2 ADA), those trash tokens will be securely locked.
            If you send more ADA than the required minimum, you'll receive our exclusive <strong>FAN Token</strong> as a reward, allowing you to show your pride as a
            "LION of Cardano" who is helping to maintain a clean ecosystem.
        </p>
        <a class="btn" href="#send-tokens">Send Your Tokens Now</a>
    </div>

    <div id="send-tokens">
        <h2>Send Tokens</h2>
        <p>
            To dispose of your SCAM or unwanted tokens, send them to the following address:
        </p>
        <p><strong>Address:</strong> <code>COMING SOON</code></p>
        <p>
            Help us keep the Cardano ecosystem clean and earn your FAN Token!
        </p>
    </div>

    <div class="wallet-info">
        <h2>Connect Your Wallet</h2>
        <button id="connectWallet" class="btn">Connect Wallet</button>
        <p id="walletAddress">Wallet Address: Not Connected</p>
        <p id="walletBalance">Balance: Not Connected</p>
    </div>
</div>

<div class="footer">
    <p>&copy; 2024 TKAN.io - All Rights Reserved</p>
    <div class="social">
        <p>Follow us on <a href="https://x.com/TKan_Komainu" target="_blank">@TKan_Komainu</a></p>
    </div>
</div>

<script>
    // Function to decode a Base64 string to a Uint8Array
    function base64ToUint8Array(base64) {
        const raw = atob(base64);
        const rawLength = raw.length;
        const array = new Uint8Array(rawLength);
        for (let i = 0; i < rawLength; i++) {
            array[i] = raw.charCodeAt(i);
        }
        return array;
    }
    /* Particle.js Configuration */
    particlesJS("particles-js", {
        "particles": {
            "number": {
                "value": 80,
                "density": { "enable": true, "value_area": 800 }
            },
            "color": { "value": "#ffffff" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.5 },
            "size": { "value": 3 },
            "line_linked": {
                "enable": true,
                "distance": 150,
                "color": "#ffffff",
                "opacity": 0.4,
                "width": 1
            },
            "move": {
                "enable": true,
                "speed": 2,
                "direction": "none",
                "random": false,
                "straight": false,
                "out_mode": "out",
                "bounce": false
            }
        }
    });

    /* Eternl Wallet Connection Logic */
       document.addEventListener('DOMContentLoaded', () => {
        const connectWalletButton = document.getElementById('connectWallet');
        const walletAddressDisplay = document.getElementById('walletAddress');
        const walletBalanceDisplay = document.getElementById('walletBalance');
        const tokenDetailsDisplay = document.getElementById('tokenDetails');

        connectWalletButton.addEventListener('click', async () => {
            try {
                if (!window.cardano || !window.cardano.eternl) {
                    throw new Error('Eternl wallet is not available. Please install Eternl wallet.');
                }
                console.log("Window.cardano", window.cardano);

                const eternlWallet = await window.cardano.eternl.enable();
                console.log("Wallet ", eternlWallet);
                
                // Get the change Bech32 address
                const address = await eternlWallet.getChangeAddress();
                walletAddressDisplay.innerHTML = `Wallet Address: <code>${address}</code>`;

                // Fetch all UTXOs
                const utxos = await eternlWallet.getUtxos();
                console.log('UTXOs:', utxos);

                // Parse ADA balance and multi-asset balances
                let adaBalance = 0;
                const tokenBalances = {};

               // Loop through each UTXO
            utxos.forEach((utxoBase64, index) => {
                try {
                        // Decode Base64 into a Uint8Array
                        const utxoBytes = base64ToUint8Array(utxoBase64);
                        console.log(`UTXO ${index} Bytes:`, utxoBytes);

                        // Decode CBOR
                        const decoded = CBOR.decode(utxoBytes.buffer);
                        console.log(`Decoded UTXO ${index}:`, decoded);

                        // ADA balance is always the first asset (index 0)
                        const lovelace = parseInt(decoded[1][0][1], 10); // ADA in Lovelace
                        adaBalance += lovelace;

                        // Handle multi-asset tokens (index 1)
                        const assets = decoded[1][1];
                        if (assets) {
                            assets.forEach(([policyId, assetList]) => {
                                assetList.forEach(([assetName, quantity]) => {
                                    const policyHex = Array.from(policyId, (byte) =>
                                        byte.toString(16).padStart(2, '0')
                                    ).join('');
                                    const name = Array.from(assetName, (byte) =>
                                        String.fromCharCode(byte)
                                    ).join('');
                                    const key = `${policyHex}.${name}`;
                                    tokenBalances[key] = (tokenBalances[key] || 0) + parseInt(quantity, 10);
                                });
                            });
                        }
                    } catch (decodeError) {
                        console.error(`Failed to decode UTXO ${index}:`, decodeError);
                    }
                });

                // Display ADA balance
                walletBalanceDisplay.innerHTML = `Balance: <strong>${(adaBalance / 1_000_000).toFixed(6)} ADA</strong>`;

                // Display token balances
                tokenDetailsDisplay.innerHTML = '<h3>Tokens:</h3>';
                Object.entries(tokenBalances).forEach(([key, quantity]) => {
                    const [policyId, assetName] = key.split('.');
                    tokenDetailsDisplay.innerHTML += `
                        <p><strong>${assetName || 'Unnamed Token'}:</strong> ${quantity} (Policy ID: ${policyId})</p>
                    `;
                });
            } catch (error) {
                console.error('Wallet connection failed:', error);
                walletAddressDisplay.textContent = 'Wallet Address: Failed to connect wallet.';
                walletBalanceDisplay.textContent = 'Balance: Failed to connect wallet.';
            }
        });
    });
</script>

</body
